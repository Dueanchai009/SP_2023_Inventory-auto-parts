import{r as i,o as J,c as H,a as I,b as f,d as h,e,w as n,v as d,h as K,i as z,J as G,g as w,j as S,K as U,A as Q,p as y,k as u,q as V,l as m,y as X,L as Y,m as Z,u as B,s as ee,x as se}from"./index-9cdb50d4.js";import{u as C,w as te,E as oe}from"./jspdf.plugin.autotable-ea3ddaf5.js";const ae={class:"d-flex justify-content-between align-items-center mb-3"},le={class:"d-flex align-items-center"},ne=e("span",{class:"me-2"},"ค้นหา: ",-1),de=e("br",null,null,-1),re=e("div",null,[e("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#exampleModal","data-bs-whatever":"@fat"},"เพิ่มพนักงาน")],-1),ie={class:"table-responsiv"},ce={class:"btn-group"},ue=["onClick"],me=e("i",{class:"bx bxs-lock-open-alt",style:{color:"#ffffff"}},null,-1),be=[me],pe=["onClick"],ve=e("i",{class:"bx bx-edit-alt"},null,-1),_e=[ve],fe=["onClick"],he=e("i",{class:"bx bx-trash"},null,-1),ye=[he],we={ref:"exampleModal",class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ge={class:"modal-dialog"},xe={class:"modal-content"},Ce=e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"พนักงาน",-1),ke={class:"modal-body"},Me={class:"row"},Se={key:0,class:"alert alert-danger"},Ue={class:"mb-3 col-lg-6"},Ve=e("label",{for:"category-name",class:"col-form-label"},"ชื่อ:",-1),Be={class:"mb-3 col-lg-6"},Ee=e("label",{for:"category-name",class:"col-form-label"},"ชื่อสกุล:",-1),Pe={class:"mb-3 col-lg-12"},qe=e("label",{for:"category-name",class:"col-form-label"},"ชื่อพนักงาน:",-1),$e={class:"mb-3 col-lg-12"},De=e("label",{for:"category-name",class:"col-form-label"},"อีเมล:",-1),Te=["disabled"],je={class:"mb-3 col-lg-12"},Re=e("label",{for:"category-name",class:"col-form-label"},"รหัสผ่าน:",-1),Le=["disabled"],Ne=e("div",{class:"col-12"},[e("button",{class:"btn btn-success w-100",type:"submit"},"บันทึก")],-1),We={class:"modal fade",id:"exampleModalPassword",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Ae={class:"modal-dialog"},Fe={class:"modal-content"},Oe=e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"พนักงาน",-1),Je={class:"modal-body"},He=["onSubmit"],Ie={class:"row"},Ke={key:0,class:"alert alert-danger"},ze={class:"mb-3 col-lg-6"},Ge=e("label",{for:"category-name",class:"col-form-label"},"ชื่อ:",-1),Qe={class:"mb-3 col-lg-6"},Xe=e("label",{for:"category-name",class:"col-form-label"},"ชื่อสกุล:",-1),Ye={class:"mb-3 col-lg-12"},Ze=e("label",{for:"category-name",class:"col-form-label"},"ชื่อพนักงาน:",-1),es={class:"mb-3 col-lg-12"},ss=e("label",{for:"category-name",class:"col-form-label"},"อีเมล:",-1),ts={class:"mb-3 col-lg-12"},os=e("label",{for:"category-name",class:"col-form-label"},"รหัสผ่านใหม่:",-1),as={class:"col-lg-12"},ls=["disabled"],ns={key:0},ds={class:"modal-footer"},rs=["disabled"],ms={__name:"Employee",setup(is){const E=i("email"),g=i(""),x=i(""),c=i(!1),o=i({firstname:"",lastname:"",email:"",password:"",username:""}),P=i([{text:"#",value:"index"},{text:"ชื่อผู้ใช้",value:"username"},{text:"อีเมล",value:"email"},{text:"จัดการ",value:"manager"}]),b=i([]),p=i(!1),v=i("");let k=JSON.parse(localStorage.getItem("user")).uid;const q=()=>{const a=C.json_to_sheet(b.value.map(l=>({ชื่อผู้ใช้งาน:l.username,อีเมล:l.email}))),s=C.book_new();C.book_append_sheet(s,a),te(s,"ข้อมูลอะไหล่รถยนต์.xlsx")},D=()=>{const a=b.value.map(l=>`
  <tr>
    <td>${l.username}</td>
    <td>${l.email}</td>
  </tr>`),s=window.open("","_blank");s.document.open(),s.document.write(` 
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
    </style>
    <table>
      <thead>
        <tr>
            <th>ชื่อผู้ใช้</th>
            <th>อีเมล</th>
        </tr>
      </thead>
      <tbody>
        ${a.join("")}
      </tbody>
    </table>
  `),s.document.close(),s.print()},T=()=>{const a=new oe,s=b.value.map(r=>({ชื่อผู้ใช้:r.username,อีเมล:r.email}));if(s.length===0){openPopup("ไม่มีอะไล่รถยนต์","error");return}const l=Object.keys(s[0]),t=s.map(r=>l.map(O=>r[O]));a.autoTable({head:[l],body:t}),a.save("ข้อมูลอะไหล่รถยนต์.pdf")},j=async a=>{p.value=!0;const s=y(u(m,"users"),a),l=await V(s);o.value={id:l.id,...l.data()},$("#exampleModalPassword").modal("show")},R=async()=>{const a=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});a.fire({title:"ต้องการพนักงาน?",text:"เมื่อลบแล้วจะไม่สามารถนำกลับมาได้!",icon:"warning",showCancelButton:!0,confirmButtonText:"ตกลง",cancelButtonText:"ยกเลิก",reverseButtons:!0}).then(async s=>{try{if(s.isConfirmed){c.value=!0;const l=y(u(m,"users"),k);await X(l),a.fire({title:"ลบพนักงานสำเร็จ!",text:"",icon:"success"})}else s.dismiss===Swal.DismissReason.cancel&&a.fire({title:"ยกเลิกรายการ",text:"",icon:"error"})}catch(l){console.error("Error deleting product:",l)}})},L=async()=>{try{c.value=!0;const a=y(u(m,"users"),o.value.id);await B(a,{password:x.value}),Swal.fire({position:"center",icon:"success",title:"อัพเดตรหัสผ่านสำเร็จ",showConfirmButton:!1,timer:1500}),_(),c.value=!1}catch(a){c.value=!1,console.error("Error updating password:",a.message)}},N=()=>{o.value.password.length<6?v.value="กรุณากรอกรหัสผ่านให้มากกว่า 6 หลัก":createUserWithEmailAndPassword(Y,o.value.email,o.value.password).then(a=>{const s=u(m,"users"),l={...o.value,uid:a.user.uid};Z(s,l),Swal.fire({position:"center",icon:"success",title:"เพิ่มพนักงานสำเร็จ",showConfirmButton:!1,timer:1500}),$("#exampleModal").modal("hide")}).catch(a=>{switch(console.log(a.code),a.code){case"auth/email-already-in-use":v.value="อีเมลนี้มีผู้ใช้งานแล้วในระบบ"}})},W=async a=>{try{p.value=!0;const s=y(u(m,"users"),a),l=await V(s);o.value={uid:l.id,...l.data()},$("#exampleModal").modal("show")}catch(s){console.error("Error fetching/updating product:",s)}},A=async()=>{try{console.log(o.value.uid);const a=y(u(m,"users"),o.value.uid);await B(a,o.value),console.log("User updated successfully"),o.value={firstname:"",lastname:"",email:"",password:"",username:""},Swal.fire({position:"center",icon:"success",title:"อัพเดตสำเร็จ",showConfirmButton:!1,timer:1500}),_()}catch(a){console.error("Error updating product:",a)}},F=()=>{const a=ee(u(m,"users"));return se(a,l=>{b.value=[],l.forEach(t=>{const r={id:t.id,username:t.data().username,email:t.data().email,password:t.data().password};b.value.push(r)})})},_=()=>{p.value=!1,o.value={firstname:"",lastname:"",email:"",password:"",username:""},$("#exampleModal").modal("hide"),$("#exampleModalPassword").modal("hide")};J(()=>{F()});const M=H(()=>p.value?A:N);return(a,s)=>{const l=I("EasyDataTable");return f(),h("div",null,[e("div",ae,[e("div",le,[ne,n(e("input",{class:"form-control",type:"text","onUpdate:modelValue":s[0]||(s[0]=t=>g.value=t)},null,512),[[d,g.value]]),e("button",{onClick:q,class:"btn btn-outline-success ms-2 btn-sm"},"Excel"),e("button",{onClick:T,class:"btn btn-outline-info ms-2 btn-sm"},"Pdf"),e("button",{onClick:D,class:"btn btn-outline-secondary ms-2 btn-sm"},"Print"),de]),re]),e("div",ie,[K(l,{headers:P.value,items:b.value,"search-field":E.value,"search-value":g.value},{"item-manager":z(t=>[e("div",ce,[e("button",{class:"btn btn-secondary",onClick:r=>j(t.id)},be,8,ue),e("button",{class:"btn btn-warning",onClick:r=>W(t.id)},_e,8,pe),!G(k)==t.id?(f(),h("button",{key:0,class:"btn btn-danger",onClick:r=>R(t.id)},ye,8,fe)):w("",!0)])]),_:1},8,["headers","items","search-field","search-value"])]),e("div",we,[e("div",ge,[e("div",xe,[e("div",{class:"modal-header"},[Ce,e("button",{type:"button",class:"btn-close",onClick:_,"aria-label":"Close"})]),e("div",ke,[e("form",{onSubmit:s[6]||(s[6]=S((...t)=>M.value&&M.value(...t),["prevent"]))},[e("div",Me,[v.value?(f(),h("div",Se,[e("ul",null,[e("li",null,U(v.value),1)])])):w("",!0),e("div",Ue,[Ve,n(e("input",{required:"","onUpdate:modelValue":s[1]||(s[1]=t=>o.value.firstname=t),type:"text",class:"form-control",placeholder:"โปรดระบุชื่อพนักงาน"},null,512),[[d,o.value.firstname]])]),e("div",Be,[Ee,n(e("input",{required:"","onUpdate:modelValue":s[2]||(s[2]=t=>o.value.lastname=t),type:"text",class:"form-control",placeholder:"โปรดระบุชื่อพนักงาน"},null,512),[[d,o.value.lastname]])]),e("div",Pe,[qe,n(e("input",{required:"","onUpdate:modelValue":s[3]||(s[3]=t=>o.value.username=t),type:"text",class:"form-control",placeholder:"โปรดระบุชื่อพนักงาน"},null,512),[[d,o.value.username]])]),e("div",$e,[De,n(e("input",{disabled:p.value,"onUpdate:modelValue":s[4]||(s[4]=t=>o.value.email=t),type:"email",class:"form-control",placeholder:"โปรดระบุอีเมล"},null,8,Te),[[d,o.value.email]])]),e("div",je,[Re,n(e("input",{disabled:p.value,required:"","onUpdate:modelValue":s[5]||(s[5]=t=>o.value.password=t),type:"password",class:"form-control",placeholder:"โปรดระบุรหัสผ่าน"},null,8,Le),[[d,o.value.password]])]),Ne])],32)]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:_},"ปิด")])])])],512),e("div",We,[e("div",Ae,[e("div",Fe,[e("div",{class:"modal-header"},[Oe,e("button",{type:"button",class:"btn-close",onClick:_,"aria-label":"Close"})]),e("div",Je,[e("form",{onSubmit:S(L,["prevent"])},[e("div",Ie,[v.value?(f(),h("div",Ke,[e("ul",null,[e("li",null,U(v.value),1)])])):w("",!0),e("div",ze,[Ge,n(e("input",{disabled:"",required:"","onUpdate:modelValue":s[7]||(s[7]=t=>o.value.firstname=t),type:"text",class:"form-control",placeholder:"โปรดระบุชื่อพนักงาน"},null,512),[[d,o.value.firstname]])]),e("div",Qe,[Xe,n(e("input",{disabled:"",required:"","onUpdate:modelValue":s[8]||(s[8]=t=>o.value.lastname=t),type:"text",class:"form-control",placeholder:"โปรดระบุชื่อพนักงาน"},null,512),[[d,o.value.lastname]])]),e("div",Ye,[Ze,n(e("input",{disabled:"",required:"","onUpdate:modelValue":s[9]||(s[9]=t=>o.value.username=t),type:"text",class:"form-control",placeholder:"โปรดระบุชื่อพนักงาน"},null,512),[[d,o.value.username]])]),e("div",es,[ss,n(e("input",{disabled:"",required:"","onUpdate:modelValue":s[10]||(s[10]=t=>o.value.email=t),type:"email",class:"form-control",placeholder:"โปรดระบุอีเมล"},null,512),[[d,o.value.email]])]),e("div",null,[e("div",ts,[os,n(e("input",{required:"","onUpdate:modelValue":s[11]||(s[11]=t=>x.value=t),type:"password",class:"form-control",placeholder:"โปรดระบุรหัสผ่าน"},null,512),[[d,x.value]])])]),e("div",as,[e("button",{type:"submit",class:"btn btn-primary w-100",disabled:c.value},[Q("อัพเดตรหัสผ่าน"),c.value?(f(),h("span",ns,"...")):w("",!0)],8,ls)])])],40,He)]),e("div",ds,[e("button",{type:"button",class:"btn btn-secondary",onClick:_,disabled:c.value},"ปิด",8,rs)])])])])])}}};export{ms as default};
