import{r as i,z as B,o as C,a as P,b as _,d as m,e as o,h as R,j as E,w as r,v as s,A as M,g as f,k as v,x as T,l as b,m as L,p as N,u as j}from"./index-9cdb50d4.js";import{g as O,a as A,r as H}from"./index.esm2017-31610523.js";const z={class:"row"},F={class:"col"},Y=o("h3",{class:"text-center mb-3"},"ฟอร์มเบิกอะไหล่",-1),Z={class:"mb-3"},G=o("label",{for:""},"เลือกอะไหล่",-1),I={key:0},J=o("div",{class:"border-primary border mb-3"},null,-1),K=o("h4",null,"รายละเอียดอะไหล่",-1),Q={class:"d-flex justify-content-center"},W=["src"],X=["onSubmit"],tt={class:"row"},ot={class:"mb-3 col-lg-4"},et=o("label",{for:"category-name",class:"col-form-label"},"ประเภท:",-1),lt={class:"mb-3 col-lg-4"},at=o("label",{for:"",class:"col-form-label"},"ยี่ห้อ:",-1),rt={class:"mb-3 col-lg-4"},st=o("label",{for:"",class:"col-form-label"},"ผู้จำหน่าย:",-1),ct={class:"mb-3 col-lg-12"},dt=o("label",{for:"",class:"col-form-label"},"ชื่อสินค้า:",-1),ut={class:"mb-3 col-lg-4"},nt=o("label",{for:"",class:"col-form-label"},"รหัสสินค้า:",-1),it={class:"mb-3 col-lg-4"},pt=o("label",{for:"",class:"col-form-label"},"ราคาขาย:",-1),_t={class:"mb-3 col-lg-4"},mt=o("label",{for:"",class:"col-form-label"},"คงเหลือ:",-1),vt={class:"mb-3 col-lg-12"},bt=o("label",{for:"",class:"col-form-label"},"จำนวนเบิกสินค้า:",-1),ht={class:"col-12"},ft=["disabled"],gt={key:0},xt={__name:"Order",setup(yt){const g=O(),d=i(null),n=i(!1),t=i(null),p=i([]),y=new Date,w={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1},q=y.toLocaleDateString("th-TH",w),x=async()=>{const a=v(b,"products");return T(a,c=>{p.value=[],c.forEach(async e=>{try{const u=e.data().product_img?`files/${e.data().product_img}`:null,h=u?await A(H(g,u)):null,S={id:e.id,product_brand:e.data().product_brand,product_category:e.data().product_category,product_code:e.data().product_code,product_cost:e.data().product_cost,product_name:e.data().product_name,product_price:e.data().product_price,product_quantity:e.data().product_quantity,product_seller:e.data().product_seller,product_img:h};p.value.push(S)}catch(u){console.error("Error fetching image URL:",u)}})})};B(d,a=>{a===null?t.value=null:t.value={...d.value,withdraw_count:1}});const V=()=>{console.log("test"),t.value={...d.value,withdraw_count:1}},D=async()=>{n.value=!0,t.value.withdraw_count>t.value.product_quantity?Swal.fire({position:"center",icon:"error",title:"สินค้าคงหลือไม่เพียงพอ",showConfirmButton:!1,timer:1500}):(t.value.withdraw_count>t.value.product_quantity,U(t.value),await k(),Swal.fire({position:"center",icon:"success",title:"เบิกอะไล่สำเร็จ",showConfirmButton:!1,timer:1500}),t.value=null,d.value=null),n.value=!1},k=async()=>{try{const a=t.value.product_quantity-t.value.withdraw_count,l=v(b,"reports"),c={month:"long",timeZone:"Asia/Bangkok"},e=new Date().toLocaleDateString("TH",c),u={product_name:t.value.product_name,product_code:t.value.product_code,product_brand:t.value.product_brand,product_category:t.value.product_category,product_seller:t.value.product_seller,quantity:t.value.withdraw_count,stock:a,type_stock:1,date:q,day:new Date().getDate(),month:e,year:new Date().getFullYear()+543},h=await L(l,u);t.value={id:null,product_name:"",product_code:"",product_brand:"",product_category:"",product_price:"",product_cost:"",product_quantity:"",product_seller:""}}catch(a){console.error("Error updating product:",a)}},U=async a=>{try{const l=N(v(b,"products"),a.id),c=a.product_quantity-a.withdraw_count;await j(l,{product_quantity:c}),a.value={id:null,product_name:"",product_code:"",product_brand:"",product_category:"",product_price:"",product_cost:"",product_quantity:"",product_seller:""},$("#exampleModal").modal("hide")}catch(l){console.error("Error updating product:",l)}};return C(()=>{x()}),(a,l)=>{const c=P("v-select");return _(),m("div",null,[o("div",z,[o("div",F,[Y,o("div",Z,[G,R(c,{options:p.value,placeholder:"กรุณาเลือกอะไหล่",label:"product_name",modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),onChange:V},null,8,["options","modelValue"])]),t.value?(_(),m("div",I,[J,K,o("div",Q,[o("img",{class:"rounded",width:"250",height:"250",src:t.value.product_img?t.value.product_img:"/images.png",alt:""},null,8,W)]),o("form",{onSubmit:E(D,["prevent"])},[o("div",tt,[o("div",ot,[et,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[1]||(l[1]=e=>t.value.product_category=e),type:"text",class:"form-control",id:"category-name"},null,512),[[s,t.value.product_category]])]),o("div",lt,[at,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[2]||(l[2]=e=>t.value.product_brand=e),type:"text",class:"form-control",id:""},null,512),[[s,t.value.product_brand]])]),o("div",rt,[st,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[3]||(l[3]=e=>t.value.product_seller=e),type:"text",class:"form-control",id:""},null,512),[[s,t.value.product_seller]])]),o("div",ct,[dt,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[4]||(l[4]=e=>t.value.product_name=e),type:"text",class:"form-control",id:""},null,512),[[s,t.value.product_name]])]),o("div",ut,[nt,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[5]||(l[5]=e=>t.value.product_code=e),type:"text",class:"form-control",id:""},null,512),[[s,t.value.product_code]])]),o("div",it,[pt,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[6]||(l[6]=e=>t.value.product_price=e),type:"text",class:"form-control",id:""},null,512),[[s,t.value.product_price]])]),o("div",_t,[mt,r(o("input",{disabled:"",required:"","onUpdate:modelValue":l[7]||(l[7]=e=>t.value.product_quantity=e),type:"text",class:"form-control",id:""},null,512),[[s,t.value.product_quantity]])]),o("div",vt,[bt,r(o("input",{required:"","onUpdate:modelValue":l[8]||(l[8]=e=>t.value.withdraw_count=e),min:"1",type:"number",class:"form-control",id:""},null,512),[[s,t.value.withdraw_count]])]),o("div",ht,[o("button",{class:"btn btn-success w-100",type:"submit",disabled:n.value},[M("เบิกอะไหล่"),n.value?(_(),m("span",gt,"...")):f("",!0)],8,ft)])])],40,X)])):f("",!0)])])])}}};export{xt as default};
