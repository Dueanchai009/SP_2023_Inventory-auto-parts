import{r as u,o as Z,c as G,a as J,b,d as h,e as t,w as c,v as n,f as K,g as Q,h as X,i as y,n as tt,j as ot,k as p,l as _,m as E,p as q,q as et,u as at,s as st,t as lt,x as rt,y as ct}from"./index-9cdb50d4.js";import{g as nt,r as C,u as M,a as dt}from"./index.esm2017-31610523.js";import{L as ut}from"./Loader-bf1a129c.js";import{u as D,w as it,E as pt}from"./jspdf.plugin.autotable-ea3ddaf5.js";const _t={class:"d-block d-lg-flex justify-content-between align-items-center mb-3"},mt={class:"d-flex align-items-center"},bt=t("span",{class:"me-2"},"ค้นหา: ",-1),vt=t("br",null,null,-1),gt=t("div",null,[t("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#exampleModal","data-bs-whatever":"@fat"},"เพิ่มสินค้า")],-1),ft={class:"table-responsiv"},ht={class:"btn-group"},yt=["onClick"],xt=t("i",{class:"bx bx-edit-alt"},null,-1),wt=[xt],kt=["onClick"],qt=t("i",{class:"bx bx-trash"},null,-1),Ct=[qt],Dt=["src"],Bt={key:0},$t={key:1},Et={key:2},Mt=t("span",null,"ไม่มีอะไหล่สินค้าในระบบ",-1),Ut={ref:"exampleModal",class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Rt={class:"modal-dialog modal-xl"},St={class:"modal-content"},Vt=t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"สินค้า",-1),Pt={class:"modal-body"},Tt={class:"row"},jt={class:"mb-3 col-lg-4"},Lt=t("label",{for:"category-name",class:"col-form-label"},"ประเภท:",-1),Ft={class:"mb-3 col-lg-4"},Ot=t("label",{for:"",class:"col-form-label"},"ยี่ห้อ:",-1),Ht={class:"mb-3 col-lg-4"},Nt=t("label",{for:"",class:"col-form-label"},"ผู้จำหน่าย:",-1),Wt={class:"mb-3 col-lg-6"},zt=t("label",{for:"",class:"col-form-label"},"รหัสสินค้า:",-1),At={class:"mb-3 col-lg-6"},It=t("label",{for:"",class:"col-form-label"},"ชื่อสินค้า:",-1),Yt={class:"mb-3 col-lg-4"},Zt=t("label",{for:"",class:"col-form-label"},"ราคาทุน:",-1),Gt={class:"mb-3 col-lg-4"},Jt=t("label",{for:"",class:"col-form-label"},"ราคาขาย:",-1),Kt={class:"mb-3 col-lg-4"},Qt=t("label",{for:"",class:"col-form-label"},"จำนวน:",-1),Xt={class:"mb-3 col-lg-12"},to=t("label",{for:"",class:"col-form-label"},"รุปภาพ (ไม่บังคับ):",-1),oo={class:"col-12"},eo=["disabled"],no={__name:"Stock",setup(ao){const x=nt(),U=new Date,R={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1},S=U.toLocaleDateString("th-TH",R),V=u("product_name"),w=u(""),i=u(!1),a=u({product_name:"",product_code:"",product_brand:"",product_category:"",product_price:"",product_cost:"",product_quantity:"",product_seller:"",product_img:""}),P=u([{text:"ภาพ",value:"product_img"},{text:"รหัส",value:"product_code"},{text:"ยี่ห้อ",value:"product_brand"},{text:"สินค้า",value:"product_name"},{text:"ประเภท",value:"product_category"},{text:"สถานะ",value:"status"},{text:"จำนวน",value:"product_quantity"},{text:"ผู้จำหน่าย",value:"product_seller"},{text:"จัดการ",value:"manager"}]),d=u([]),v=u(!1),g=u(!1),T=s=>{let o;return s<=5&&s>0?o="badge text-bg-warning text-white":s>6?o="badge text-bg-success":o="badge text-bg-danger",o},j=()=>{const s=D.json_to_sheet(d.value.map(l=>({รหัสสินค้า:l.product_code,สินค้า:l.product_name,ประเภท:l.product_category,ยี่ห้อ:l.product_brand,จำนวน:l.product_quantity,ผู้จำหน่าย:l.product_seller}))),o=D.book_new();D.book_append_sheet(o,s),it(o,"ข้อมูลอะไหล่รถยนต์.xlsx")},L=()=>{const s=d.value.map(l=>`
  <tr>
    <td>${l.product_code}</td>
    <td>${l.product_name}</td>
    <td>${l.product_category}</td>
    <td>${l.product_brand}</td>
    <td>${l.product_quantity}</td>
    <td>${l.product_seller}</td>
  </tr>`),o=window.open("","_blank");o.document.open(),o.document.write(` 
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
    </style>
    <table>
      <thead>
        <tr>
            <th>รหัสสินค้า</th>
            <th>สินค้า</th>
            <th>ประเภท</th>
            <th>ยี่ห้อ</th>
            <th>จำนวน</th>
            <th>ผู้จำหน่าย</th>
        </tr>
      </thead>
      <tbody>
        ${s.join("")}
      </tbody>
    </table>
  `),o.document.close(),o.print()},F=()=>{const s=new pt,o=d.value.map(r=>({code:r.product_code,name:r.product_name,category:r.product_category,brand:r.product_brand,quantity:r.product_quantity,seller:r.product_seller}));if(o.length===0){k("ไม่มีอะไล่รถยนต์","error");return}const l=Object.keys(o[0]),e=o.map(r=>l.map(m=>r[m]));s.autoTable({head:[l],body:e}),s.save("ข้อมูลอะไหล่รถยนต์.pdf")},O=async s=>{g.value=!0,a.value.product_img=s.target.files[0]},H=async()=>{try{v.value=!1;const o=p(_,"products");var s={...a.value};if(g.value){var s={...a.value,product_img:a.value.product_img.name};const r=C(x,"files/"+a.value.product_img.name),m=await M(r,a.value.product_img);console.log("File uploaded successfully:",m)}const l=await E(o,s);await I(),f(),k("สร้างสินค้าสำเร็จ")}catch(o){console.error("Error uploading file:",o)}},N=async s=>{try{if(s===null){console.error("Invalid product_id: null");return}v.value=!0;const o=q(p(_,"products"),s),l=await et(o);l.exists()?(console.log(l.id),a.value={...l.data(),id:s},$("#exampleModal").modal("show")):console.error(`Product with ID ${s} does not exist.`)}catch(o){console.error("Error fetching/updating product:",o)}},W=async()=>{try{$("#exampleModal").modal("hide");const o=q(p(_,"products"),a.value.id);var s={...a.value};if(g.value)var s={...a.value,product_img:a.value.product_img.name};if(await at(o,s),a.value.product_img&&a.value.product_img!==null)try{const l=C(x,"files/"+a.value.product_img.name),e=await M(l,a.value.product_img)}catch(l){console.error("Error uploading file:",l)}f(),k("อัพเดตสินค้าสำเร็จ")}catch(o){console.error("Error updating product:",o)}},z=async()=>{const s=st(p(_,"products"),lt("product_code","desc"));return rt(s,l=>{d.value=[],l.forEach(async e=>{try{i.value=!0;const r=e.data().product_img?`files/${e.data().product_img}`:null,m=r?await dt(C(x,r)):null,Y={id:e.id,product_brand:e.data().product_brand,product_category:e.data().product_category,product_code:e.data().product_code,product_cost:e.data().product_cost,product_name:e.data().product_name,product_price:e.data().product_price,product_quantity:e.data().product_quantity,product_seller:e.data().product_seller,product_img:m};d.value.push(Y),i.value=!1}catch(r){console.error("Error fetching image URL:",r),i.value=!1}})})},A=s=>{const o=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});o.fire({title:"ต้องการลบอะไหล่สินค้า?",text:"เมื่อลบแล้วจะไม่สามารถนำกลับมาได้!",icon:"warning",showCancelButton:!0,confirmButtonText:"ตกลง",cancelButtonText:"ยกเลิก",reverseButtons:!0}).then(l=>{try{if(l.isConfirmed){const e=q(p(_,"products"),s);ct(e),d.value=d.value.filter(r=>r.id!==s),o.fire({title:"ลบอะไหล่สำเร็จ!",text:"",icon:"success"})}else l.dismiss===Swal.DismissReason.cancel&&o.fire({title:"ยกเลิกรายการ",text:"",icon:"error"})}catch(e){console.error("Error deleting product:",e)}})},f=()=>{v.value=!1,g.value=!1,a.value={id:null,product_name:"",product_code:"",product_brand:"",product_category:"",product_price:"",product_cost:"",product_quantity:"",product_seller:"",product_img:""},$("#exampleModal").modal("hide")},I=async()=>{try{const s=p(_,"reports"),o={month:"long",timeZone:"Asia/Bangkok"},l=new Date().toLocaleDateString("TH",o),e={product_name:a.value.product_name,product_code:a.value.product_code,product_brand:a.value.product_brand,product_category:a.value.product_category,product_seller:a.value.product_seller,quantity:a.value.product_quantity,stock:a.value.product_quantity,type_stock:0,date:S,day:new Date().getDate(),month:l,year:new Date().getFullYear()+543},r=await E(s,e);a.value={id:null,product_name:"",product_code:"",product_brand:"",product_category:"",product_price:"",product_cost:"",product_quantity:"",product_seller:"",product_img:""}}catch(s){console.error("Error updating product:",s)}};Z(async()=>{i.value=!0,z(),i.value=!1});const k=(s,o="success")=>{Swal.fire({position:"center",icon:o,title:s,showConfirmButton:!1,timer:1500})},B=G(()=>v.value?W:H);return(s,o)=>{const l=J("EasyDataTable");return b(),h("div",null,[t("div",_t,[t("div",mt,[bt,c(t("input",{class:"form-control",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>w.value=e),placeholder:"ระบุชื่อสินค้า"},null,512),[[n,w.value]]),t("button",{onClick:j,class:"btn btn-outline-success ms-2 btn-sm"},"Export"),t("button",{onClick:F,class:"btn btn-outline-info ms-2 btn-sm"},"Pdf"),t("button",{onClick:L,class:"btn btn-outline-secondary ms-2 btn-sm"},"Print"),vt]),gt]),i.value?(b(),K(ut,{key:0})):Q("",!0),t("div",ft,[X(l,{headers:P.value,items:d.value,"search-field":V.value,"search-value":w.value},{"item-manager":y(e=>[t("div",ht,[t("button",{class:"btn btn-warning",onClick:r=>N(e.id)},wt,8,yt),t("button",{class:"btn btn-danger",onClick:r=>A(e.id)},Ct,8,kt)])]),"item-product_img":y(e=>[t("img",{width:"54",height:"54",src:e.product_img?e.product_img:"/images.png",alt:""},null,8,Dt)]),"item-status":y(e=>[t("span",{class:tt(`
                        ${T(e.product_quantity)} p-2 border-0`),style:{"font-size":"12px"}},[e.product_quantity<=5&&e.product_quantity>1?(b(),h("span",Bt,"ไกล้หมด")):e.product_quantity>5?(b(),h("span",$t,"ปกติ")):(b(),h("span",Et,"หมด"))],2)]),"empty-message":y(()=>[Mt]),_:1},8,["headers","items","search-field","search-value"])]),t("div",Ut,[t("div",Rt,[t("div",St,[t("div",{class:"modal-header"},[Vt,t("button",{type:"button",class:"btn-close",onClick:f,"aria-label":"Close"})]),t("div",Pt,[t("form",{onSubmit:o[9]||(o[9]=ot((...e)=>B.value&&B.value(...e),["prevent"]))},[t("div",Tt,[t("div",jt,[Lt,c(t("input",{required:"","onUpdate:modelValue":o[1]||(o[1]=e=>a.value.product_category=e),type:"text",class:"form-control",id:"category-name"},null,512),[[n,a.value.product_category]])]),t("div",Ft,[Ot,c(t("input",{required:"","onUpdate:modelValue":o[2]||(o[2]=e=>a.value.product_brand=e),type:"text",class:"form-control",id:""},null,512),[[n,a.value.product_brand]])]),t("div",Ht,[Nt,c(t("input",{required:"","onUpdate:modelValue":o[3]||(o[3]=e=>a.value.product_seller=e),type:"text",class:"form-control",id:""},null,512),[[n,a.value.product_seller]])]),t("div",Wt,[zt,c(t("input",{required:"","onUpdate:modelValue":o[4]||(o[4]=e=>a.value.product_code=e),type:"text",class:"form-control",id:""},null,512),[[n,a.value.product_code]])]),t("div",At,[It,c(t("input",{required:"","onUpdate:modelValue":o[5]||(o[5]=e=>a.value.product_name=e),type:"text",class:"form-control",id:""},null,512),[[n,a.value.product_name]])]),t("div",Yt,[Zt,c(t("input",{required:"","onUpdate:modelValue":o[6]||(o[6]=e=>a.value.product_cost=e),type:"number",class:"form-control",id:""},null,512),[[n,a.value.product_cost]])]),t("div",Gt,[Jt,c(t("input",{required:"","onUpdate:modelValue":o[7]||(o[7]=e=>a.value.product_price=e),type:"number",class:"form-control",id:""},null,512),[[n,a.value.product_price]])]),t("div",Kt,[Qt,c(t("input",{required:"","onUpdate:modelValue":o[8]||(o[8]=e=>a.value.product_quantity=e),type:"number",class:"form-control",id:""},null,512),[[n,a.value.product_quantity]])]),t("div",Xt,[to,t("input",{type:"file",onChange:O,class:"form-control"},null,32)]),t("div",oo,[t("button",{class:"btn btn-success w-100",type:"submit",disabled:i.value},"บันทึก",8,eo)])])],32)]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary",onClick:f},"ปิด")])])])],512)])}}};export{no as default};
